/* 
    last update : 
        date : 2018/12/29
        new  : rewrite
    author:
        SRM_XY Yeuoly
    group:
        VSOV
    website:
        NotForget
*/window.onload=function(){this.constDom=new InitWeb();this.constDom.functionGroup.passJct();if(this.constDom.functionGroup.isOnline()!==true){$("#sec_master").html("赶快登陆呐");$("#thr_master_1").css({"display":""})}else{$("#sec_master").html("您已经登录了哦~注册新账号咩~");$("#thr_master_2").css({"display":""})}$("#login_btn").click(function(){var b=$("#l-userid").val();var a=$("#l-pswd").val();if(!(a+b).match(/\b[a-zA-Z0-9\.]{12,32}\b/)){$("#sec_master").html("密码或账号不符合规范");return}verifyToken(b,a)});$("#go_register").click(function(){$("#sec_master").html("开启新世界的大门叭！");$("#thr_master_1").css({"display":"none"});$("#thr_master_2").css({"display":""})});$("#get_captcha_btn").click(function(){getCaptcha()});$("#get_email_captcha_btn").click(function(){var b=$("#r-email").val();var a=$("#r-captcha").val();if(!b.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)){$("#sec_master").html("邮箱格式错误");return}else{if(!a.match(/\d+/)){$("#sec_master").html("验证码错误");return}else{requestEmailVerification(b,a)}}});$("#register_btn").click(function(){var c=$("#r-userid").val();var a=$("#r-pswd").val();var b=$("#r-verification").val();if(!(c+c).match(/\b[a-zA-Z0-9\.]{12,32}\b/)){$("#sec_master").html("密码或账号不符合规范");return}else{if(!b.match(/\d+/)){$("#sec_master").html("验证码错误");return}}registerMaster(c,a,b)})};function verifyToken(c,a){var b=pisert();$.ajax({url:static_data.getUrlPath("Login.php",static_data.m_URL_DOMAIN_API_DIR),async:true,type:"post",data:{act:c,pswd:a,tim:b[0]/1000,rnd:b[1]},dataType:"json",contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:true},success:function(d){if(d["data"]["res"]===static_data.response.login.failed){$("#sec_master").html((d["data"]["error"]))}else{if(d["data"]["res"]===static_data.response.login.success){location.href=static_data.getUrlPath("",static_data.m_URL_DOMAIN_WEB_DIR)}}}})}function requestEmailVerification(b,a){$.ajax({url:static_data.getUrlPath("Verification.php",static_data.m_URL_DOMAIN_API_DIR),async:true,type:"post",data:{email:b,method:"register",captcha:a},dataType:"json",contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:true},success:function(c){if(c["data"]["res"]===static_data.response.requestVerification.success){$("#sec_master").html(static_data.baseinfo.m_VERIFICATION_SUCCESS)}else{$("#sec_master").html(c["data"]["error"])}}})}function registerMaster(d,a,b){var c=pisert();$.ajax({url:static_data.getUrlPath("Register.php",static_data.m_URL_DOMAIN_API_DIR),async:true,type:"post",data:{act:d,pswd:a,captcha:b,tim:c[0]/1000,rnd:c[1]},dataType:"json",contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:true},success:function(e){if(e["data"]["res"]===static_data.response.register.failed){$("#sec_master").html(e["data"]["error"])}else{location.href=static_data.getUrlPath("LogOff.php",static_data.m_URL_DOMAIN_API_DIR)+"?next="+static_data.getUrlPath("passport.html",static_data.m_URL_DOMAIN_WEB_DIR)}}})}function getCaptcha(){$("#register_captcha").attr("src",static_data.getUrlPath("Captcha.php?method=register",static_data.m_URL_DOMAIN_API_DIR))};